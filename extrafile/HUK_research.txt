رﯾرﻘﺗقﯾﻗدﺗﻟاﻲﺋﺎﻧﺟﻟاﻲﻧﻣﻷالﻣﺎﺷﻟاﺔﯾرﺎﻣﻌﻣﻟرﯾﻔﺷﺗﻟاﻲﻓ
فﺗﺎھ JKM-LX1 ﺞﻟﺎﻌﻣو Kirin 710: لﯾﻠﺣﺗقﻣﻌﻣﺔﯾﻟﻵ
نﯾزﺧﺗ HUK تﻻوﻛوﺗروﺑوقﺎﻘﺗﺷﻻاديﺎﺗﻌﻟا
1. ﺔﻣدﻘﻣﻟاقﺎطﻧﻟواﻲﺟﮭﻧﻣﻟاثﺣﺑﻠﻟ
لﺛﻣﯾذاھرﯾرﻘﺗﻟاﺔﻘﯾﺛوﺔﯾﻌﺟرﻣﺔﯾﻧﻘﺗﺔﻠﻣﺎﺷدفﮭﺗﻰﻟإراءﺟإقﯾﻗدﺗﻲﺋﺎﻧﺟ (Forensic Audit) قﯾﻗدﺔﯾﺎﻐﻠﻟتﺎﻧﺎﯾﺑﻠﻟتﺎﯾﺿرﻔﻟوا
ﺔﻘﻠﻌﺗﻣﻟاﺔﯾﻧﺑﻟﺎﺑﺔﯾﻧﻣﻷافﺗﺎﮭﻟ Huawei Y9 2019 ( روفﻌﻣﻟا
 ً
ﺎﯾﻧﻘﺗ
زﻣرﻟﺎﺑ JKM-LX1)، ذيﻟوادﻣﺗﻌﯾﻲﻓﮫﺗﺎﯾﻠﻣﻋﺔﯾﺑﺎﺳﺣﻟاﺔﯾﻧﻣﻷوا
ﻰﻠﻋﺔﻣظوﻧﻣﺔﺟﻟﺎﻌﻣ HiSilicon Kirin 710. ﻲﺗﺄﯾذاھثﺣﺑﻟاﺔﺑﺎﺟﺗﺳابﻠطﻟﻲﻧﻘﺗددﺣﻣقﻘﺣﺗﻠﻟنﻣﺔﺣﺻقﺋﺎﺛوﻟاﺔﯾﻧﻔﻟاواردةﻟاﻲﻓ
فﻠﻣﻟاﻲﻌﺟرﻣﻟا
1
،ﻊﻣزﯾﻛرﺗﻟالﻛﺷﺑصﺎﺧﻰﻠﻋﺢﯾﺣﺻﺗمﯾھﺎﻔﻣﻟاﺔﯾرھوﺟﻟاﺔﻘﻠﻌﺗﻣﻟانﺎﻛﻣﺑنﯾزﺧﺗحﺎﺗﻔﻣﻟادﯾرﻔﻟازةﮭﺟﻸﻟ (Hardware
Unique Key - HUK)، صﺣﻓودوىﺟﻟاﺔﯾﻧﻘﺗﻟاﮫﺟراﺧﺗﺳﻻرﺑﻋتﺎﮭﺟواعﻼﻗإمﺎظﻧﻟا (Fastboot).
وزﺎﺟﺗﯾذاھرﯾرﻘﺗﻟاردﺟﻣﺔﺑﺎﺟﻹامﻌﻧﺑأو،ﻻدمﻘﯾﻟ
 ً
ﺎﺣﯾرﺷﺗ
 ً
ﺎﯾرﺎﻣﻌﻣ
 ً
ﻼﻣﺎﻛ 
(Architectural Dissection) ﺔﯾﻔﯾﻛﻟلﻣﺎﻌﺗتﺎﺟﻟﺎﻌﻣ
Kirin ﻊﻣرارﺳﻷا.ﺔﯾرﯾﻔﺷﺗﻟاموﻘﻧﺳكﯾﻛﻔﺗﺑﺔﻗﻼﻌﻟاةدﻘﻌﻣﻟانﯾﺑكرﺣﻣرﯾﻔﺷﺗﻟا (Crypto Engine) تارﮭﺻﻣﻟاوﺔﯾﻧورﺗﻛﻟﻹا
(eFuses)، ﺢﯾﺿوﺗوتﺎﻗورﻔﻟاﺔﯾﺋﺎﯾزﯾﻔﻟاﺔﯾﻘطﻧﻣﻟاو.ﺎﻣﮭﻧﯾﺑﺎﻣﻛلوﺎﻧﺗﯾﺳرﯾرﻘﺗﻟالﯾﻠﺣﺗﻟﺎﺑدوﻛﻟاﻲﺟﻣرﺑﻟامدﻘﻣﻟاﻲﻓﺔﻘﯾﺛوﻟا،ﺔﻘﻓرﻣﻟا
 ً
ﺎﺣﺿوﻣ
طﺎﻘﻧةوﻘﻟاروﺻﻘﻟاو،ﮫﯾﻓ
 ً
ﺎﻣدﻘﻣو
قﺎﯾﺳﻟاﻲﺟﻣرﺑﻟاﺢﯾﺣﺻﻟاﺔﯾﻔﯾﻛﻟلﻋﺎﻔﺗمﺎظﻧدﯾوردﻧأﻊﻣﺔﺋﯾﺑذﯾﻔﻧﺗﻟاﺔﻗوﺛوﻣﻟا (Trusted
Execution Environment - TEE) ﻲﻓاذھلﯾﺟﻟانﻣفﺗاوﮭﻟا .
دﻣﺗﻌﯾﺞﮭﻧﻣﻟاﻲﻠﯾﻠﺣﺗﻟاﻲﻓذاھرﯾرﻘﺗﻟاﻰﻠﻋﺔﻘﺑﺎطﻣتﺎﻣوﻠﻌﻣﻟاواردةﻟاﻲﻓﺔﻘﯾﺛوﻟا
1
ﻊﻣرﯾﯾﺎﻌﻣﻟاﺔﯾﺳدﻧﮭﻟاﺔﻘﺛوﻣﻟاﺔﯾرﺎﻣﻌﻣﻟ ARM
TrustZone، تﺎﺳرﺎﻣﻣورﯾﻔﺷﺗﻟاﺔﯾﺳﺎﯾﻘﻟاﻲﻓمﺎظﻧدﯾدروﻧأ (AOSP)، ﺔﻓﺎﺿﻹﺎﺑﻰﻟإﺔﺳدﻧﮭﻟاﺔﯾﺳﻛﻌﻟاﺔﺻﺎﺧﻟاتﻻوﻛوﺗروﺑﺑواويھ
.ﺔﯾﻧﻣﻷافدﮭﻟاﻲﺋﺎﮭﻧﻟاوھمﯾدﻘﺗةروﺻ،ﺔﺣﺿاو،ﺔﻘﯾﻗدﺔﻠﺑﺎﻗوذﯾﻔﻧﺗﻠﻟثﺣﺎﺑﻠﻟﻲﻧﻣﻷاوأقﻘﺣﻣﻟا،ﻲﺋﺎﻧﺟﻟاﺔﯾﻟﺎﺧنﻣسﺑﻠﻟاﻲﻣﯾھﺎﻔﻣﻟاﻊﺋﺎﺷﻟا
لوﺣنﯾأ"شﯾﻌﺗﺢﯾﺗﺎﻔﻣﻟا ".
2. لﯾﻠﺣﺗﻟاريﺎﻣﻌﻣﻟاﺞﻟﺎﻌﻣﻟ Kirin 710: سﺳﻷاﺔﯾﺋﺎﯾزﯾﻔﻟانﻣﻸﻟ
مﮭﻔﻟﺔﻗدتﺎﻣوﻠﻌﻣﻟاواردةﻟاﻲﻓرﯾرﻘﺗﻟا
1
ﺔﺑﺎﺟﻹواﻰﻠﻋتﻻؤﺎﺳﺗدمﺧﺗﺳﻣﻟاولﺣنﺎﻛﻣـﻟا HUK، بﺟﯾ
 ً
ﻻأوسﯾﺳﺄﺗمﮭﻓقﯾﻣﻋﺔﯾﻧﺑﻠﻟ
ﺔﯾﺋﺎﯾزﯾﻔﻟا.ﺞﻟﺎﻌﻣﻠﻟلؤﺎﺳﺗﻟالوﺣﺎﻣاذإنﺎﻛحﺎﺗﻔﻣﻟاﻲﻓكرﺣﻣ""رﯾﻔﺷﺗﻟامأﻲﻓ "eFuses" سﯾﻟدرﺟﻣلاؤﺳنﻋ،ﻊﻗوﻣلﺑوھلاؤﺳنﻋ
ﺔﻌﯾﺑطةدﺎﻣﻟاةرﻛاذﻟاوﻲﻓهﺎﺑﺷأتﻼﺻوﻣﻟا .
2.1 ﺔﻌﯾﺑطﻟاﺔﯾﺋﺎﯾزﯾﻔﻟاركﺣﻣﻟرﯾﻔﺷﺗﻟا (Crypto Engine - CE)
رﯾﺷﺗﺔﻘﯾﺛوﻟا
1
ﻰﻟإرﯾﻔﺷﺗ" CE Master Key"، ﺎﻧھوبﺟﯾﺢﯾﺿوﺗﺔﯾھﺎﻣـﻟا CE. كرﺣﻣرﯾﻔﺷﺗﻟاﻲﻓتﺎﺟﻟﺎﻌﻣ Kirin (وSoCs
(
ً
ﺎﻣوﻣﻋ
وھةدﺣوﺔﺟﻟﺎﻌﻣﺔﯾﻘطﻧﻣ (Logic Unit) ﺔﺻﺻﺧﻣﻊﯾرﺳﺗﻟتﺎﯾﻠﻣﻌﻟاﺔﯾﺑﺎﺳﺣﻟاةدﻘﻌﻣﻟا .
ونﻛﺗﯾركﺣﻣرﯾﻔﺷﺗﻟا
 ً
ﺎﯾﺋﺎﯾزﯾﻓنﻣنﯾﯾﻼﻣتﺎﺑواﺑﻟاﺔﯾﻘطﻧﻣﻟا (Logic Gates) ﺔﻋوﻧﺻﻣﻟانﻣوراتﺗﺳزﻧراﺗ CMOS. ذهھتﺎﺑواﺑﻟا

ﺔﻟؤوﺳﻣنﻋذﯾﻔﻧﺗتﺎﯾﻠﻣﻋ XOR، ﺔﺣزاﻹوا (Shifting)، ضﯾوﻌﺗﻟوا (Substitution) ﻲﺗﻟاﺎﮭﺑﻠطﺗﺗتﺎﯾﻣوارزﺧلﺛﻣ AES أو
RSA. ﺔﯾﺻﺎﺧﻟاﺔﯾرھوﺟﻟاذهﮭﻟتﺎﺑواﺑﻟاﻲھﺎﮭﻧأرةﯾﺎطﺗﻣ" " (Volatile). دﻣﺗﻌﺗتراوﺗﺳزﻧارﺗﻟاﻲﻓهذھرﺋاودﻟاﺔﯾﻘطﻧﻣﻟاﻰﻠﻋدوﺟورﺎﯾﺗ
ﻲﺋﺎﺑرﮭﻛرﻣﺗﺳﻣظﺎﻔﺣﻠﻟﻰﻠﻋﺎﮭﺗﻟﺎﺣوأءارﺟﻹﺔﯾﻠﻣﻌﻟا.ﺔﯾﺑﺎﺳﺣﻟادرﺟﻣﺑﻊطﻗرﺎﯾﺗﻟاﻲﺋﺎﺑرﮭﻛﻟانﻋ،ﺞﻟﺎﻌﻣﻟادﻘﻔﺗهذھتﺎﺑاوﺑﻟايأتﺎﻧﺎﯾﺑ
تﻧﺎﻛﺎﮭﺟﻟﺎﻌﺗدوﻌﺗوﻰﻟإﺔﻟﺎﺣلوﻣﺧﻟاﺔﯾرﻔﺻﻟا .
 ً
ءﺎﻧﺑﻰﻠﻋذهھﺔﻘﯾﻘﺣﻟا،ﺔﯾﺋﺎﯾزﯾﻔﻟانﺈﻓركﺣﻣرﯾﻔﺷﺗﻟا (Crypto Engine) ﻻكﻠﺗﻣﯾدرةﻘﻟاﻰﻠﻋ"نﯾزﺧﺗ"تﺎﻧﺎﯾﺑﻟالﻛﺷﺑ.مﺋادوھمﻣﺻﻣ
نوﻛﯾﻟ"ﻊﻧﺻﻣﻟا"يذﻟاﺞﻟﺎﻌﯾ،تﺎﻧﺎﯾﺑﻟاسﯾﻟو"نزﺧﻣﻟا"يذﻟا.ﺎﮭظﻔﺣﯾيوﺗﺣﯾكرﺣﻣﻟاﻊﺑطﻟﺎﺑﻰﻠﻋتﻼﺟﺳﻣﺔﯾﻠﺧاد (Internal
Registers) ةرﻛاذوﺔﺗﻗؤﻣةرﯾﻐﺻ (SRAM Buاers) ظﻔﺣﻟﺢﯾﺗﺎﻔﻣﻟاتﺎﻧﺎﯾﺑﻟاوءﺎﻧﺛأﺔﯾﻠﻣﻋرﯾﻔﺷﺗﻟا،طﻘﻓنﻛﻟوهذھةرﻛاذﻟادﻘﻔﺗ
ﺎھاوﺗﺣﻣروﻓةدﺎﻋإلﯾﻐﺷﺗﻟاوأفﺎﻘﯾإ.لﯾﻐﺷﺗﻟا،نذإﺔﯾﺿرﻔﻟاﺔﻠﺋﺎﻘﻟانﺄﺑـﻟا HUK نزﺧﻣلﺧادـﻟا Crypto Engine لﻛﺷﺑمﺋادﻲھ
ﺔﯾﺿرﻓرﯾﻏﺔﺣﯾﺣﺻ،
ً
ﺎﯾﺋﺎﯾزﯾﻓـﻟﺎﻓ CE وھكﻠﮭﺗﺳﻣحﺎﺗﻔﻣﻠﻟسﯾﻟو
 ً
ءﺎﻋو
ﮫﻟ .
2.2 ﺔﻌﯾﺑطﻟاﺔﯾﺋﺎﯾزﯾﻔﻟاراتﮭﺻﻣﻠﻟﺔﯾﻧروﺗﻛﻟﻹا (eFuses) ﺎﮭﺗﻔﯾووظﺔﯾﻧﯾزﺧﺗﻟا
ﻲﻓل،ﺑﺎﻘﻣﻟالﺛﻣﺗراتﮭﺻﻣﻟاﺔﯾﻧروﺗﻛﻟﻹا (eFuses) رةﻛذارﯾﻏرةﯾﺎطﺗﻣدمﺧﺗﺳﺗرةﻣﻟدةﺣوا (One-Time Programmable -
OTP). ﻰﻠﻋوىﺗﺳﻣﻟاري،ﮭﺟﻣﻟاونﻛﺗﺗـﻟا eFuse نﻣطﺑراﻲﺋﺎﯾزﯾﻓقﯾﻗد (Fusible Link) وعﻧﺻﻣنﻣدةﺎﻣﺔﻠﺻوﻣلﺛﻣﻲﻟوﺑﻟا
ونﻛﯾﻠﯾﺳﻊﺑﺷﻣﻟا (Doped Polysilicon) أوﺔﻛﯾﺑﺳﺔﯾﻧدﻌﻣﺔﺻﺎﺧ .
ءﺎﻧﺛأﺔﯾﻠﻣﻋﻊﯾﻧﺻﺗﻟاأورﯾﻓوﺗ"ﺢﯾﺗﺎﻔﻣﻟا " (Key Provisioning) ﻲﻓ،ﻊﻧﺻﻣﻟامﺗﯾﺔﺑﺎﺗﻛتﺎﻧﺎﯾﺑﻟاﻰﻠﻋهذھةرﻛاذﻟانﻋقﯾرطرﯾرﻣﺗرﺎﯾﺗ
ﻲﺋﺎﺑرﮭﻛيذﺔﻓﺎﺛﻛﺔﯾﻟﺎﻋ
 ً
ادﺟ
رﺑﻋطﺑارﻟا.لﺻوﻣﻟايدؤﺗهذھﺔﻓﺎﺛﻛﻟاﺔﯾﻟﺎﻌﻟاﻰﻟإةرھﺎظﻰﻣﺳﺗةرﺟﮭﻟا"ﺔﯾﻧورﺗﻛﻟﻹا "
(Electromigration)، ثﯾﺣﻊﻓدﻧﺗتارذةدﺎﻣﻟاﺔﻠﺻوﻣﻟاكرﺣﺗﺗونﻣ،ﺎﮭﻧﺎﻛﻣﺎﻣﻣقﻠﺧﯾةوﺟﻓﺔﯾﺋﺎﯾزﯾﻓﻊطﻘﺗةرﺋادﻟا.ﺔﯾﺋﺎﺑرﮭﻛﻟااذھ
ﻊطﻘﻟارﯾﻐﯾﺔﻣوﺎﻘﻣرﮭﺻﻣﻟالﻛﺷﺑ،يرذﺟﺎﻣﻣمﺟرﺗﯾ
 ً
ﺎﯾﻘطﻧﻣ
نﻣ"0"ﻰﻟإ"1"وأ)سﻛﻌﻟابﺳﺣ.(مﯾﻣﺻﺗﻟااذھرﯾﯾﻐﺗﻟاوھرﯾﯾﻐﺗﻲﺋﺎﯾزﯾﻓ
ﻲﻓﺔﯾﻧﺑ،ﺔﺣﯾرﺷﻟاﻲﻟﺎﺗﻟﺎﺑووﮭﻓمﺋادﻻودﻣﺗﻌﯾﻰﻠﻋدوﺟوردﺻﻣﺔﻗﺎط .
 ً
ءﺎﻧﺑﻰﻠﻋك،ﻟذنﺈﻓﺔﺑﺎﺟﻹاﺔﻌطﺎﻘﻟاﺔﻣوﻋدﻣﻟوالﺋﻻدﻟﺎﺑﺔﯾﺳدﻧﮭﻟاﻲھأنحﺎﺗﻔﻣﻟادﯾرﻔﻟازةﮭﺟﻸﻟ (HUK) زنﺧﻣ
 ً
ﺎﯾرﺻﺣﻲﻓﺔﻓوﻔﺻﻣ
eFuses. ذهھﺔﻓوﻔﺻﻣﻟاﻲھنﺎﻛﻣﻟادﯾﺣوﻟالﺧداﺔﺣﯾرﺷونﻛﯾﻠﯾﺳﻟادرﺎﻘﻟاﻰﻠﻋظﺎﻔﺗﺣﻻاتﺎﻧﺎﯾﺑﺑﺔﯾرﺳدةﯾرﻓلﻛﻟزﺎﮭﺟلﻛﺷﺑمﺋدا
ومﺎﻘﻣوب،ﻋﻼﺗﻠﻟﻰﺗﺣﻲﻓبﺎﯾﻏﺔﻗﺎطﻟا .
2.3 ﺔﻠﺣر:حﺎﺗﻔﻣﻟالﻣﺎﻛﺗﻟانﯾﺑ eFuse و Crypto Engine
ﺔﻟزاﻹسﺑﻠﻟاذيﻟادﻗونﻛﯾوردﻲﻓنھذثﺣﺎﺑﻟاأوﻲﻓﺔﻘﯾﺛوﻟا
1
،بﺟﯾرحﺷﺔﯾﻔﯾﻛلﺎﻘﺗﻧا.حﺎﺗﻔﻣﻟامﺎظﻧﻟالﻣﻌﯾلﻣﺎﻛﺗﺑقﯾﻗدنﯾﺑنﯾﺗدﺣوﻟا :
1. ﺔﻠﺣرﻣعﻼﻗﻹاردﺎﺑﻟا (Cold Boot): دﻧﻋطﻐﺿزرل،ﯾﻐﺷﺗﻟادأﺑﺗرﺋدواﺔﻗﺎطﻟالﻣﻌﻟﺎﺑرارﻘﺗﺳوادﮭﺟﻟا .
2. راءةﻗ:راتﮭﺻﻣﻟاموﻘﺗةدﺣومﻛﺣﺗﺔﺻﺎﺧ (eFuse Controller) ةءارﻘﺑﺔﻟﺎﺣﻟاﺔﯾﺋﺎﯾزﯾﻔﻟاﺔﻓوﻔﺻﻣﻟ،تارﮭﺻﻣﻟاﺎﻣﺑﻲﻓكﻟذ
ﺔﻘطﻧﻣﻟاﺔﯾرﺳﻟاﻲﺗﻟايوﺗﺣﺗﻰﻠﻋ HUK.
3. لﻘﻧﻟانﻣﻵا (Secure Transfer): مﺗﯾلﻘﻧﺔﻣﯾﻗ HUK رﺑﻋلﻗﺎﻧتﺎﻧﺎﯾﺑزولﻌﻣصﺻﺧﻣو (Dedicated Hardware
Bus) رةﺷﺎﺑﻣنﻣدةﺣومﻛﺣﺗﻟاﻲﻓراتﮭﺻﻣﻟاﻰﻟإتﻼﺟﺳﻣ"ﺢﯾﺗﺎﻔﻣﻟاﺔﻧﻣﻵا " (Secure Key Registers) ةدوﺟوﻣﻟالﺧاد
كرﺣﻣرﯾﻔﺷﺗﻟا (Crypto Engine).
4. لﻔﻘﻟاديﺎﺗﻌﻟا (Hardware Locking): ردﺟﻣﺑرارﻘﺗﺳاحﺎﺗﻔﻣﻟالﺧداتﻼﺟﺳﻣركﺣﻣر،ﯾﻔﺷﺗﻟامﺗﯾلﯾﻌﻔﺗرةﺎﺷإﺔﯾدﺎﺗﻋ
ﻰﻣﺳﺗ "Read Disable" ذهﮭﻟ.تﻼﺟﺳﻣﻟااذھﻲﻧﻌﯾنأكرﺣﻣرﯾﻔﺷﺗﻟاﺢﺑﺻأنﻵا"فرﻌﯾ"حﺎﺗﻔﻣﻟاﮫﻧﻛﻣﯾوﮫﻣادﺧﺗﺳاكﻔﻟ
رﯾﻔﺷﺗ،تﺎﻧﺎﯾﺑﻟانﻛﻟوﻻدﺟوﺗيأﺔﻣﯾﻠﻌﺗﺔﯾﺟﻣرﺑ (Software Instruction) ﺎﮭﻧﻛﻣﯾةءارﻗىوﺗﺣﻣهذھتﻼﺟﺳﻣﻟاجارﺧإو
حﺎﺗﻔﻣﻟاﺎﮭﻧﻣ .
إذن،ـﻟا HUK " "نﻛﺳﯾﻲﻓ eFuses، ﮫﻧﻛﻟو"لﻣﻌﯾ"لﺧاد Crypto Engine. ﺔﻘﯾﺛوﻟا
1
تﻧﺎﻛﺔﻘﯾﻗدﺎﻣدﻧﻋترﻛذنأتﺎﯾﻠﻣﻌﻟامﺗﺗ
لﺧاد TrustedCore مادﺧﺗﺳﺎﺑ،ﺢﯾﺗﺎﻔﻣﺎﮭﻧﻛﻟﺎﻣﺑرمﻟلﺻﻔﺗﻲﻓزﯾﯾﻣﺗﻟاﻲﺋﺎﯾزﯾﻔﻟانﯾﺑنﺎﻛﻣنﯾزﺧﺗﻟانﺎﻛﻣو،ﺔﺟﻟﺎﻌﻣﻟاوھوﺎﻣﺎﻧﻣﻗ
ﮫﺣﯾﺣﺻﺗﺑﮫﺣﯾﺿوﺗوﺎﻧھ .

3. قﯾﻗدﺗﺔﻘﯾﺛوﻟا
1
ﻲﻓذاھم،ﺳﻘﻟاومﻘﻧﺔﻌﺟراﻣﺑﺔﻘﯾﻗد
 ً
طراﺳ""رطﺳﺑتﺎﻣوﻠﻌﻣﻠﻟةدراوﻟاﻲﻓﺔﻘﯾﺛوﻟاﺔﻘﻓرﻣﻟا
1
،ﺎﮭﺗﻧرﺎﻘﻣوقﺋﺎﻘﺣﻟﺎﺑﺔﯾﻧﻘﺗﻟامﺎظﻧﻟدﯾوردﻧأ
تﺎﺟﻟﺎﻌﻣو Kirin.
3.1 قﯾﻗدﺗﺔﯾﻧﺑلﯾﯾذﺗ"رﯾﻔﺷﺗﻟا " (Crypto Footer)
رتﻛذﺔﻘﯾﺛوﻟاأنفﺗﺎﮭﻟادمﺧﺗﺳﯾلﯾﯾذﺗ""رﯾﻔﺷﺗﻲﻓرﺧآ16تﯾﺎﺑوﻠﯾﻛنﻣمﺳﻗ userdata. هذھﺔﻣوﻠﻌﻣﻟاﺔﺣﯾﺣﺻ.
ً
ﺎﻣﺎﻣﺗﻰﻠﻋمﻏرﻟانﻣ
نأﺔﻣظﻧأدﯾوردﻧأﺔﺛﯾدﺣﻟاتﻠﻘﺗﻧاﻰﻟإرﯾﻔﺷﺗﻟامﺋﺎﻘﻟاﻰﻠﻋتﺎﻔﻠﻣﻟا (FBE)، ﻻإنأيواوھتدﻣﺗﻋا
 ً
ﺎﺟﮭﻧ
 ً
ﺎﻧﯾﺟھ
ﻲﻓكﻠﺗ.ةرﺗﻔﻟاتظﻔﺗﺣاﺔﯾﻧﺑﺑ
crypبs ﺔﻣﯾدﻘﻟاﺔﻣدﺧﺗﺳﻣﻟا)ﻲﻓ FDE) سﯾﻟرﯾﻔﺷﺗﻟصرﻘﻟا،لﻣﺎﻛﻟﺎﺑلﺑةرادﻹﺢﯾﺗﺎﻔﻣ"رﯾﻔﺷﺗتﺎﻧﺎﯾﺑﻟاﺔﯾﻔﺻوﻟا " (Metadata
Encryption Keys) ﺔﯾﺎﻣﺣوـﻟا Blobs ﺔﺻﺎﺧﻟاـﺑ Keymaster. دوﺟولﯾﯾذﺗﻟاﺔﻣﯾﻘﻟاوﺔﯾرﺣﺳﻟا0 xD0B5B1C4 وھﺔﻘﯾﻘﺣ
ةدﻛؤﻣﻲﻓدوﻛﻟايردﺻﻣﻟامﺎظﻧﻟدﯾوردﻧأ (AOSP)،
 ً
 
ادﯾدﺣﺗو
ﻲﻓفﻠﻣ crypبs.h. هذھﺔﻣﯾﻘﻟاﺔﯾرﺣﺳﻟاﻲھﻊﯾﻗوﺗﻟاﻲﺳﺎﯾﻘﻟايذﻟاثﺣﺑﯾ
ﮫﻧﻋمﺎظﻧﻟافرﻌﺗﻠﻟﻰﻠﻋدوﺟوةدﺣونﯾزﺧﺗةرﻔﺷﻣ .
3.2 لﯾﻠﺣﺗوعﻧﺔﻟداقﺎﻘﺗﺷﻻا (KDF Type 5)
رتﺎﺷأﺔﻘﯾﺛوﻟاﻰﻟإأن kdf_type لﻣﺣﯾﺔﻣﯾﻘﻟا5،ﺎﮭﺗرﺳﻓوﺎﮭﻧﺄﺑ KDF_SCRYPT_KEYMASTER. ذاھلﯾﻠﺣﺗﻟالﺛﻣﯾﺔﻗدﺔﯾﻟﺎﻋﻲﻓ
ثﺣﺑﻟاﻲﺋﺎﻧﺟﻟارﺑﺗﻌﯾوﺔطﻘﻧوةﻗﻲﻓ.ﺔﻘﯾﺛوﻟا1
ﻲﻓمﺎظﻧدﯾدروﻧأﻲﺳﺎﯾﻘﻟا (Vanilla Android)، مﯾﻘﻟاﺔﻓروﻌﻣﻟاﻲھ :
● 1: رﯾﺷﺗﻰﻟإ KDF_SCRYPT.
● 2: رﯾﺷﺗﻰﻟإ KDF_PBKDF2.
ورﮭظﺔﻣﯾﻘﻟا5وھرﺷؤﻣﻲﻌطﻗﻰﻠﻋودﺟولﯾدﻌﺗنﻣلﺑﻗﺔﻛرﺷﻟاﺔﻌﻧﺻﻣﻟا (Vendor-Specific Implementation). ﻲﻓﺔﻟﺎﺣ
واويھتﺎﺟﻟﺎﻌﻣو Kirin، مﺗلﯾدﻌﺗﺔﻣدﺧإدارةداتﻠﺟﻣﻟا (vold) فﯾﺿﺗﻟذاھوعﻧﻟا.دﯾدﺟﻟاﺔﻔﯾظوﻟاﺔﯾﺳﺎﺳﻷاعوﻧﻠﻟ5ﻲھطﺑرﺔﯾﻠﻣﻋ
قﺎﻘﺗﺷاحﺎﺗﻔﻣﻟاسﯾﻟطﻘﻓﺔﻣﻠﻛﺑرورﻣﻟاﺎﻣﻛ)ﻲﻓ Scrypt ،(يدﺎﻌﻟالﺑ
 ً
ﺎﺿﯾأ
ﻊﯾﻗوﺗﺑيدﺎﺗﻋمﺗﯾلﺧادﺔﺋﯾﺑذﯾﻔﻧﺗﻟاﺔﻗوﺛوﻣﻟا (TEE). اذھ
دﻛؤﯾﺔﺣﺻﺔﯾﺿرﻔﻟاﺔﻠﺋﺎﻘﻟانﺄﺑكﻓرﯾﻔﺷﺗﻟاجرﺎﺧزﺎﮭﺟﻟا (Oا-chip decryption) لﯾﺣﺗﺳﻣ
 ً
ﺎﯾﺿﺎﯾر
نودةﺎﻛﺎﺣﻣﻊﯾﻗوﺗﻟا،يدﺎﺗﻌﻟا
نﻷﺔﻟدﺎﻌﻣﻟادﻘﺗﻔﺗرﯾﻐﺗﻣﻟﻊﯾﻗوﺗ"زﺎﮭﺟﻟا ".
3.3 مﯾﯾﻘﺗودﻛةﺎﻛﺎﺣﻣﻟا (Python Code Review)
تﻣدﻗﺔﻘﯾﺛوﻟاودﻛونﺛﯾﺎﺑةﺎﻛﺎﺣﻣﻟ.ﺔﯾﻠﻣﻌﻟادﻧﻋقﯾﻗدﺗاذھ،دوﻛﻟادﺟﻧﮫﻧأﺢﯾﺣﺻنﻣﺔﯾﺣﺎﻧﻟا"ﺔﯾﻣزراوﺧﻟا"يأ)بﯾﺗرﺗ،(تﺎﯾﻠﻣﻌﻟاﮫﻧﻛﻟو
يوﺗﺣﯾﻰﻠﻋطﯾﺳﺑﺗلﺧﻣنﻣﺔﯾﺣﺎﻧﻟاﺔﯾﻔﯾظوﻟا" ".
ودﻛﻟادمﺧﺗﺳﯾﺔﻟدا hardware_tee_sign_simulator. ﺔﻘﯾﺛوﻟاتﻓرﺗﻋانﺄﺑذاھزءﺟﻟاة،ﺎﻛﺎﺣﻣنﻛﻟوبﺟﯾدﯾدﺷﺗﻟا:ﺎﻧھاذھدوﻛﻟا
نﻟموﻘﯾكﻔﺑرﯾﻔﺷﺗتﺎﻧﺎﯾﺑﻟا
 ً
ﺎﯾﻠﻌﻓ
اذإمﺗﮫﻠﯾﻐﺷﺗﻰﻠﻋزﺎﮭﺟرﺗوﯾﺑﻣﻛمادﺧﺗﺳﺎﺑةروﺻصرﻘﻟا.طﻘﻓبﺑﺳﻟاوھنأﺔﻟادةﺎﻛﺎﺣﻣﻟاﻲﻓدوﻛﻟا
مدﺧﺗﺳﺗ SHA256 وأتﺎﯾﻠﻣﻋﺔطﯾﺳﺑلﯾﺛﻣﺗﻟ،ﻊﯾﻗوﺗﻟاﺎﻣﻧﯾﺑﻲﻓ،ﻊﻗاوﻟاﺔﯾﻠﻣﻋﻊﯾﻗوﺗﻟابﻠطﺗﺗحﺎﺗﻔﻣ RSA صﺎﺧ (Private Key)
دوﺟوﻣ
 ً
ﺎﯾرﺻﺣ
لﺧادﺞﻟﺎﻌﻣﻟانﻣﻵا (Secure Enclave) فﺗﺎﮭﻠﻟ.
ذا،ﻟﺢﯾﺣﺻﺗﻟابﺟواﻟاﮫﺗﻓﺎﺿإرﯾرﻘﺗﻠﻟوھأنذاھودﻛﻟاﺢﻠﺻﯾرحﺷﻠﻟ""ﻲﻣﯾﻠﻌﺗﻟاوأقﯾﺛوﺗﻟ"،"قﻓدﺗﻟاﮫﻧﻛﻟوسﯾﻟةادأ"لﻼﻐﺗﺳا "

(Exploit Tool) .زةھﺎﺟﮫﻠﯾوﺣﺗﻟﻰﻟإةادأ،ﺔﻟﺎﻌﻓبﺟﯾلادﺑﺗﺳاﺔﻟادةﺎﻛﺎﺣﻣﻟاﺞﻣﺎﻧرﺑﺑلﺻﺗﯾفﺗﺎﮭﻟﺎﺑﻲﻠﻌﻔﻟارﺑﻋ) ADB (
ً
ﻼﺛﻣ
بﻠطﯾﻟ
نﻣﺞﻟﺎﻌﻣﻟاءارﺟإﻊﯾﻗوﺗﻟاﻲﻘﯾﻘﺣﻟاةدﺎﻋإوﺔﺟﯾﺗﻧﻟا .
4. ﺔﯾﻧﺎﻛﻣإراجﺧﺗﺳا HUK رﺑﻋ Fastboot: لﯾﻠﺣﺗﻟاﻲﺋﺎﻧﺟﻟادمﻘﺗﻣﻟا
لﻘﺗﻧﻧنﻵاﺔﺑﺎﺟﻺﻟﺔﻠﺻﻔﻣﻟاﻰﻠﻋؤالﺳدمﺧﺗﺳﻣﻟا:ريھوﺟﻟاوﻟ"ـﻟا HUK ﻲﻓـﻟا eFues يدﻧﻋوﺔﻟادﻲﻓـﻟا fastboot أرﻘﺗلﻛـﻟا
eFues، لھردﻗأ؟ﮫﺟرﺧﺗﺳأ "
4.1 ﺔﯾﻠﻛﯾھﺔﻓوﻔﺻﻣراتﮭﺻﻣﻟاﺎﮭﺗﯾﺎﻣﺣو
ﺔﻓوﻔﺻﻣ eFuses ﻲﻓتﺎﺟﻟﺎﻌﻣ HiSilicon تﺳﯾﻟﺔﻠﺗﻛرةﻛذادةﺣواﺔﺣوﺗﻔﻣ.ﺔﺣطﺳﻣوﻲھﺔﻣﺳﻘﻣ
 ً
ﺎﯾﻣﯾظﻧﺗﻰﻟإكوﻧﺑ" " (Banks) وأ
،قطﺎﻧﻣلﻛﻟوﺔﻘطﻧﻣتﺎﯾﺣﻼﺻلوﺻوةددﺣﻣﺔﻣارﺻﺑ :
● ﺔﻘطﻧﻣمﻛﺣﺗﻟا (Control Block): ويﺗﺣﺗﻰﻠﻋتﺎﻓرﻌﻣﺔﺣﯾرﺷﻟاداداتﻋوإ.رددﺗﻟاةدﺎﻋﺎﻣنوﻛﺗﺔﻠﺑﺎﻗةءارﻘﻠﻟ .
● ﺔﻘطﻧﻣﻊﯾﻧﺻﺗﻟا (Calibration Block): طﺑﺿﻟﺔﯾﺗﻟوﻔﻟارارةﺣﻟوا .
● ﺔﻘطﻧﻣﻟاﺔﯾﻧﻣﻷا (Security Block): ذهھﻲھﺔﻘطﻧﻣﻟاﺔﻧﺻﺣﻣﻟاﻲﺗﻟاويﺗﺣﺗﻰﻠﻋ :
○ HUK: حﺎﺗﻔﻣرﯾﻔﺷﺗﻟاذريﺟﻟا .
○ ROTPK Hash: ﺔﻣﺻﺑحﺎﺗﻔﻣقﻘﺣﺗﻟانﻣﺔﺣﺻعﻼﻗﻹا (Secure Boot).
○ Secure Boot Enable Bit: تﺑلﯾﻌﻔﺗنﻣﻷا .
4.2 ﺔﯾﻟآبﺟﺣﻟاديﺎﺗﻌﻟا (Shadow Registers Masking)
ﺎﻣدﻧﻋومﻘﺗذﯾﻔﻧﺗﺑﺔﻟداﻲﻓ Fastboot راءةﻘﻟ eFuses (لﺛﻣ fastboot oem read_efuse رةﻓوﺗﻣﻟاﻲﻓﺦﺳﻧ،(ﻊﻧﺻﻣﻟانﺈﻓ
مﺎظﻧﻟاﻻأرﻘﯾرﮭﺻﻣﻟاﻲﺋﺎﯾزﯾﻔﻟاةرﺷﺎﺑﻣﻲﻓكﻠﺗ.ﺔظﺣﻠﻟا
 ً
ﻻدﺑ
نﻣ،كﻟذوھأرﻘﯾنﻣتﻼﺟﺳﻣ"لظﻟا " (Shadow Registers).
ﺔﯾﻟآلﻣﻌﻟاﻲھﻲﻟﺎﺗﻟﺎﻛ :
1. دﻧﻋدءﺑلﯾﻐﺷﺗﻟا (Reset)، ومﻘﺗدةﺣومﻛﺣﺗﻟاﻲﻓراتﮭﺻﻣﻟاﺦﺳﻧﺑمﯾﻘﻟاﺔﯾﺋﺎﯾزﯾﻔﻟاﻰﻟإتﻼﺟﺳﻣظلﻟاﻲﻓرةﻛذاﻟا (SRAM).
2. لﻼﺧذهھ،ﺔﯾﻠﻣﻌﻟاقﻘﺣﺗﺗدةﺣومﻛﺣﺗﻟانﻣتﺎﺗﺑ"ﻊﻧﻣةءارﻘﻟا " (Read Disable Bits).
3. ﻲﻓفﺗواﮭﻟاﺔﯾرﺎﺟﺗﻟالﺛﻣ) JKM-LX1 يذﻟاعﺎﺑﯾ،(نﯾﻣدﺧﺗﺳﻣﻠﻟنوﻛﺗتﺎﺗﺑﺔﯾﺎﻣﺣﻟاﺔﺻﺎﺧﻟاﺔﻘطﻧﻣﺑ HUK ﺔﻗورﺣﻣ
 ً
ﺎﻘﺑﺳﻣﻲﻓ
ﻊﻧﺻﻣﻟا.
4. ﺔﺟﯾﺗﻧذاﮭﻟرق،ﺣﻟاومﻘﺗدةﺣومﻛﺣﺗﻟاـﺑرﯾﻔﺻﺗ (Zeroing out) أوبﺟﺣتﺎﻧﺎﯾﺑﻟاﺔﻟوﻘﻧﻣﻟاﻰﻟإتﻼﺟﺳﻣظلﻟاﺔﺻﺎﺧﻟاـﺑ
HUK.
4.3 دوىﺟﻟاﺔﯾﻧﻘﺗﻟاراجﺧﺗﺳﻼﻟ
ً
ءﺎﻧﺑﻰﻠﻋﺔﯾﻟﻵاﺔﺣروﺷﻣﻟاه،ﻼﻋأنﺈﻓﺔﺑﺎﺟﻹاﻲھ،ﻻﻻنﻛﻣﯾراجﺧﺗﺳا HUK رﺑﻋ Fastboot ﻲﻓزﺎﮭﺟريﺎﺟﺗقﻠﻐﻣ .
ﻰﺗﺣوﻟتﻛﻠﺗﻣا
 ً
راﻣأ
 ً
ﺎﯾﺟﻣرﺑرأﻘﯾلﻣﺎﻛ،ﺔﻓوﻔﺻﻣﻟانﺈﻓمﯾﻘﻟاﻲﺗﻟاودﻌﺗﺳكﻟنﻣنﯾوﺎﻧﻌﻟاﺔﺻﺎﺧﻟاـﺑ HUK ونﻛﺗﺳ
 ً
راﺎﻔﺻأ)0000...
00(أوتﺎﻧﺎﯾﺑﺔﯾﺋواﺷﻋﺔﻣﯾدﻋ.دةﺋﺎﻔﻟالوﻛوﺗورﺑ Fastboot لﻣﻌﯾﻲﻓىوﺗﺳﻣمﻟﺎﻌﻟا"رﯾﻏنﻣﻵا " (Non-Secure World) وأﻲﻓ
ﺔﻠﺣرﻣةرﺧﺄﺗﻣنﻣعﻼﻗﻹاثﯾﺣنوﻛﺗدﻋاوﻗﺔﯾﺎﻣﺣﻟادﻗمﺗﺎﮭﻠﯾﻌﻔﺗقﻼﻏإوتﺎﺑاوﺑﻟاﺔﯾدﺎﺗﻌﻟا .
ءﺎﻧﺛﺗﺳﻻادﯾﺣوﻟاذهﮭﻟدةﻋﺎﻘﻟاوھودﺟورةﻐﺛﻲﻓﺔﻠﺣرﻣﺎﻣلﺑﻗ Fastboot،
 ً
 داﯾدﺣﺗوﻲﻓ BootROM. راتﻐﺛﻟاﻲﻓ BootROM

( ﻲھورةﻛذاراءةﻘﻟاطﻘﻓﻲﺗﻟادأﺑﯾﺎﮭﻧﻣ(ﺞﻟﺎﻌﻣﻟادﻗﺢﻣﺳﺗمﺟﺎﮭﻣﻠﻟذﯾﻔﻧﺗﺑدوﻛلﺑﻗنأموﻘﺗةدﺣومﻛﺣﺗﻟالﯾﻌﻔﺗﺑدﻋاوﻗ،بﺟﺣﻟاوأدﻗﺢﻣﺳﺗﮫﻟ
ةءارﻘﺑنزﺧﻣﻟاتﻗؤﻣﻟاﺦﺳﻧﻠﻟلﺑﻗ.هرﯾﻔﺻﺗ،نﻛﻟومادﺧﺗﺳﺎﺑتاودﻷاﺔﯾﺳﺎﯾﻘﻟالاودﻟاوﺔﯾﺟﻣرﺑﻟاﺔﺣﺎﺗﻣﻟاﻲﻓ Fastboot، جارﺧﺗﺳﻻا
لﯾﺣﺗﺳﻣ.
4.4 تﺎﻔﺻواﻣ HUK: طولﻟاتﺎﻣﻼﻌﻟوا
ً
رداﻰﻠﻋرﺎﺳﻔﺗﺳادمﺧﺗﺳﻣﻟاولﺣلﻛﺷـﻟا HUK:
● :طولﻟاﻲﻓتﺎﺟﻟﺎﻌﻣ Kirin 710، ﻲﺗﻟامدﺧﺗﺳﺗرﯾﯾﺎﻌﻣرﯾﻔﺷﺗﻟاﺔﻣدﻘﺗﻣﻟاﺔﻘﻓاوﺗﻣﻟاﻊﻣ ARM TrustZone، نوﻛﯾلوطـﻟا
HUK ةدﺎﻋ256تﺑ)32(تﯾﺎﺑ.اذھلوطﻟارﻓوﯾﺔﺣﺎﺳﻣﺢﯾﺗﺎﻔﻣﺔﻣﺧﺿﻲﻔﻛﺗﺔﻣوﺎﻘﻣﻟتﺎﻣﺟھةوﻘﻟاﺔﻣﺷﺎﻐﻟا.نورﻘﻟﻲﻓضﻌﺑ
،تﺎﻘﯾﺑطﺗﻟادﻗمﺗﯾمادﺧﺗﺳانﯾﺣﺎﺗﻔﻣلوطﺑ128تﺑ،ﺎﻣﮭﺟﻣدونﻛﻟوﺞﺗﺎﻧﻟالﺎﻌﻔﻟاوھ256تﺑ .
● ﺔﻣﻼﻌﻟا:زةﯾﻣﻣﻟاﻻدﺟوﺗـﻠﻟ HUK يأﺔﻣﻼﻋ"ةزﯾﻣﻣ " (Marker) وأﺔﺳﯾورﺗ (Header) لﺧادﺔﻓوﻔﺻﻣ.تارﮭﺻﻣﻟاحﺎﺗﻔﻣﻟا
وھﺔﻠﺳﻠﺳنﻣتﺎﺗﺑﻟاﺔﯾﺋاوﺷﻌﻟا
 ً
ﺎﻣﺎﻣﺗ 
(High Entropy). ﻻأدﺑﯾﺔﻣﻠﻛﺑ KEY ﻻوﻲﮭﺗﻧﯾـﺑ END.
● ﺔﯾﻔﯾﻛرفﻌﺗﻟا:ﮫﯾﻠﻋمﺗﯾفرﻌﺗﻟاﮫﯾﻠﻋطﻘﻓنﻣلﻼﺧﮫﻌﻗوﻣ (OOfset/Address) ﻲﻓﺔطﯾرﺧ.تارﮭﺻﻣﻟانوﺳدﻧﮭﻣﻟاﻲﻓ
ﻊﻧﺻﻣﻟانوﻓرﻌﯾنأناوﻧﻌﻟا
 ً
ﻼﺛﻣ
)0 x1000) وھﺔﯾادﺑـﻟا HUK. اذإتﻧﻛﻣﺗنﻣلﻣﻋ Dump، نﻟدﺟﺗﺔﻣﻼﻋكﻟدﺗﮫﯾﻠﻋىوﺳ
،ﮫﻌﻗوﻣاذإونﺎﻛزﺎﮭﺟﻟا،
ً
ﺎﻧﻣؤﻣدﺟﺗﺳﮫﻧﺎﻛﻣ
 ً
ارﺎﻔﺻأ
طﻘﻓ .
5. لﯾﻠﺣﺗﺔﯾﻣوارزﺧقﺎﻘﺗﺷﻻادةﻘﻌﻣﻟا (KDF_SCRYPT_KEYMASTER)
مﯾدﻘﺗﻟقﯾﻗدﺗلﻣﺎﺷﺔﻘﯾﺛوﻠﻟ
1
،بﺟﯾدةﺎﻋإءﺎﻧﺑﺔﯾﻣوارزﺧﻟا
 ً
ﺎﯾﺿﺎﯾرﺢﯾﺿوﺗورةﻐﺛﻟاﺔﯾﻓرﻌﻣﻟاﻲﺗﻟاﻊﻘﯾﺎﮭﯾﻓرونﯾﺛﻛﻟادﻧﻋﺔﻟوﺎﺣﻣكﻓرﯾﻔﺷﺗﻟا
.
ً
ﺎﯾﺟﻣرﺑ
ﺔﯾﻠﻣﻌﻟاﻲﺗﻟاﺎﮭﻔﺻورﯾرﻘﺗﻟامﺳﺎﺑ KDF_SCRYPT_KEYMASTER ﻲھﺔﯾﻠﻣﻋةددﻌﺗﻣلﺣارﻣﻟافدﮭﺗﻰﻟإﺞﻣدرﺳ"
"مدﺧﺗﺳﻣﻟاﺔﻣﻠﻛ)(رورﻣﻟاﻊﻣرﺳ"زﺎﮭﺟﻟا " (HUK).
5.1 ﺔﻠﺣرﻣﻟا:ﻰﻟوﻷاقﺎﻘﺗﺷﻻاﻲﺟﻣرﺑﻟا (Soofware Scrypt)
دأﺑﺗﺔﯾﻠﻣﻌﻟاﺔﻣﻠﻛﺑرورﻣ.دمﺧﺗﺳﻣﻟامﺗﯾمادﺧﺗﺳاﺔﻟاد scrypt ﻲھوﺔﻟادقﺎﻘﺗﺷاﺢﯾﺗﺎﻔﻣﺔﻔﺛﻛﻣةرﻛاذﻠﻟ (Memory-Hard Function).
ضرﻐﻟاﺎﮭﻧﻣوھلﻌﺟتﺎﻣﺟھنﯾﻣﺧﺗﻟاﺔﺋﯾطﺑﺔﻔﻠﻛﻣو .
ﺔﻟدﺎﻌﻣﻟا:
$$IK1 = \text{scrypt}(P=\text{UserPassword}, S=\text{Salt}, N=2^{15}, r=3, p=1)$$
● Salt: ﺔﻣﯾﻗﺔﯾﺋواﺷﻋﺔﻧزﺧﻣﻲﻓلﯾﯾذﺗﻟامﺗ)قﻘﺣﺗﻟانﻣﺎھدوﺟوﻲﻓ Oاset 0x80).
● N=32768: لﻣﺎﻌﻣ.ﺔﻔﻠﻛﺗﻟانﻣﺿﯾنأقرﻐﺗﺳﺗﺔﯾﻠﻣﻌﻟا
 ً
ﺎﺗﻗو
 ً
ﺎظوﺣﻠﻣﻲﻟاوﺣ)(ﺔﯾﻧﺎﺛﻰﻠﻋﺞﻟﺎﻌﻣﻟا .
● IK1: حﺎﺗﻔﻣﻟاطﯾﺳوﻟا.ولﻷاهذھﺔﻣﯾﻘﻟانﻛﻣﯾﺎﮭﺑﺎﺳﺣﻰﻠﻋيأزﺎﮭﺟرﺗوﯾﺑﻣﻛاذإتﻓرﻋﺔﻣﻠﻛرورﻣﻟاﺢﻠﻣﻟاو .
5.2 ﺔﻠﺣرﻣﻟا:ﺔﯾﻧﺎﺛﻟاﻊﯾﻗوﺗﻟايدﺎﺗﻌﻟا (The Hardware Bind)
ﺎﻧھنﻣﻛﺗدةﻘﻌﻟاﻲﺗﻟالﻌﺟﺗكﻓرﯾﻔﺷﺗﻟارجﺎﺧزﺎﮭﺟﻟا
 ً
ﻼﯾﺣﺗﺳﻣ 
.
مﺗﯾلﺎﺳإر IK1 ﺔﻓﺎﺿﻹﺎﺑﻰﻟإﺔﻠﺗﻛتﺎﻧﺎﯾﺑﻰﻣﺳﺗ Keymaster Blob ( ﺔﺟرﺧﺗﺳﻣنﻣ(لﯾﯾذﺗﻟاﻰﻟإﺞﻟﺎﻌﻣﻟانﻣﻵا (TrustZone).

لﺧدامﻟﺎﻌﻟانﻣﻵا :
1. مﺗﯾكﻓرﯾﻔﺷﺗ Keymaster Blob دامﺧﺗﺳﺎﺑحﺎﺗﻔﻣقﺗﺷﻣنﻣ HUK.
2. رجﺧﺗﺳ
ُ
ﯾنﻣـﻟا Blob حﺎﺗﻔﻣصﺎﺧ (Private Key) صﺎﺧﺔﯾﻠﻣﻌﺑﻊﯾﻗوﺗﻟا .
3. مﺗﯾﻊﯾﻗوﺗ IK1 دامﺧﺗﺳﺎﺑذاھحﺎﺗﻔﻣﻟاصﺎﺧﻟا .
$$Signature = \text{Sign}(Data=IK1, Key=\text{PrivKey}_{HUK})$$
ذهھﺔﯾﻠﻣﻌﻟاﻻنﻛﻣﯾﺎﮭﺗﺎﻛﺎﺣﻣ
 ً
ﺎﯾﺟرﺎﺧ
كﻧﻷﻻكﻠﻣﺗ PrivKey ﻻوكﻠﻣﺗ HUK كﻔﻟرﯾﻔﺷﺗـﻟا Blob ذيﻟاويﺣﯾـﻟا PrivKey.
5.3 ﺔﻠﺣرﻣﻟا:ﺔﺛﻟﺎﺛﻟاقﺎﻘﺗﺷﻻاﻲﺋﺎﮭﻧﻟاكﻓورﯾﻔﺷﺗﻟا
مﺗﯾدامﺧﺗﺳاﻊﯾﻗوﺗﻟاﺞﺗﺎﻧﻟا (Signature) لﺧدﻣﻛﺔﻟداﻟ scrypt رةﻣرىﺧأأو)ﺔﻟادقﺎﻘﺗﺷاطﺳﺑأﻲﻓضﻌﺑ(تارادﺻﻹادﯾﻟوﺗﻟحﺎﺗﻔﻣ
كﻓرﯾﻔﺷﺗﻟاﻲﺋﺎﮭﻧﻟا (Disk Encryption Key - DEK).
$$DEK = \text{KDF}(Input=Signature,...)$$
ﺎﻣﺑأن Signature دﻣﺗﻌﯾ
 ً
ﺎﯾﻠﻛﻰﻠﻋ HUK، نﺈﻓ DEK ﻻنﻛﻣﯾﮫﺟﺎﺗﻧإﻻإﻰﻠﻋزﺎﮭﺟﻟاﻲﻠﺻﻷا .
6. دولﺟتﺎﻧﺎﯾﺑﻟاﺔﯾﻠﻛﯾﮭﻟاقﯾﻗدﺗﻟوارنﺎﻘﻣﻟا
لﯾﮭﺳﺗﻟمﮭﻔﻟا،ﺔﻧرﺎﻘﻣﻟوادرجﻧﺎﻧھ
 ً
ﻻدوﺟصﺧﻠﯾتﺎﻧﺎﯾﺑﻟاﻲﺗﻟامﺗقﻘﺣﺗﻟاﺎﮭﻧﻣﻲﻓﺔﻘﯾﺛوﻟا
1
ﺎﮭﺗﻧرﺎﻘﻣورﯾﯾﺎﻌﻣﻟﺎﺑﺔﯾﺳﺎﯾﻘﻟا :
رﺻﻧﻌﻟا ﺔﻣﯾﻘﻟاﻲﻓرﯾرﻘﺗﻟا قﻘﺣﺗﻟاقﯾﻗدﺗﻟا)ﻲﺋﺎﻧﺟﻟا ) تﺎظﺣﻼﻣﻟاﺔﯾﻧﻘﺗﻟا
Magic Number 0xD0B5B1C4 ﺢﯾﺣﺻ قﺑﺎطﻣرﺎﯾﻌﻣﻟ crypبs ﻲﻓ
AOSP.
OOfset رﺧآ16 KB نﻣ userdata ﺢﯾﺣﺻ ﻊﻗوﻣﻲﺳﺎﯾﻗلﯾﯾذﺗﻟرﯾﻔﺷﺗﻟاﻲﻓ
دﯾدروﻧأ.
KDF Type 5 ﺢﯾﺣﺻقﯾﻗود زﻣرﯾـﻟ Huawei
Keymaster Scrypt.
نﺎﻛﻣ HUK "Silicon" / "Hardware" جﺎﺗﺣﯾﺢﯾﺿوﺗ :ﺢﯾﺣﺻﺗﻟانزﺧﻣﻲﻓ eFuses،
دمﺧﺗﺳ
ُ
ﯾﻲﻓ Crypto
Engine.
Fastboot Access مﻟرﻛُذﯾﺔﺣراﺻ رﯾﻏنﻛﻣﻣ وبﺟﺣﻣﺔطﺳواﺑ Shadow
Registers Masking.
HUK Length رﯾﻏورﻛذﻣ 32 تﯾﺎﺑ)256 -bit) جﺎﺗﻧﺗﺳا
 ً
ءﺎﻧﺑﻰﻠﻋرﯾﯾﺎﻌﻣ ARM
TrustZone.
Python Code ةﺎﻛﺎﺣﻣ (Simulation) ﺢﯾﺣﺻ
 ً
ﺎﯾﻘطﻧﻣ جﺎﺗﺣﯾلﺎﺻﺗاﻲﻠﻌﻓفﺗﺎﮭﻟﺎﺑلﻣﻌﻠﻟ
(Oracle Attack).

7. ﺔﻣﺗﺎﺧﻟاتﺎﯾﺻوﺗﻟوا
صﻠﺧذاھرﯾرﻘﺗﻟاﻲﻘﯾﻗدﺗﻟاﻰﻟإﺔﻋوﻣﺟﻣنﻣﺞﺋﺎﺗﻧﻟاﺔﻣﺳﺎﺣﻟاﻲﺗﻟابﯾﺟﺗﻰﻠﻋتﻻؤﺎﺳﺗثﺣﺎﺑﻟاﺢﺣﺻﺗومﯾھﺎﻔﻣﻟاواردةﻟاﻲﻓﺔﻘﯾﺛوﻟا
ﺔﻘﻓرﻣﻟا:
1. ﺔﻗدﺔﻘﯾﺛوﻟا
1
:ﺔﻘﯾﺛوﻟادمﻘﺗ
 ً
ﻼﯾﻠﺣﺗ
 ً
ﺎﯾﻧﻓ
 ً
ﺎﻘﯾﻗد
 ً
ﺎﺣﯾﺣﺻوﺔﯾﻧﺑﻟرﯾﻔﺷﺗﻟاﺔﯾﺟﻣرﺑﻟاﻲﻓفﺗﺎھ JKM-LX1. تﺎﻧﺎﯾﺑﻟاﺔﻘﻠﻌﺗﻣﻟاـﺑلﯾﯾذﺗ"
"رﯾﻔﺷﺗﻟامﯾﻘﻟاوﺔﯾرﺣﺳﻟاعوﻧوﺔﯾﻣزراوﺧقﺎﻘﺗﺷﻻا (Type 5) ﺎﮭﻠﻛﺔﻘﺑﺎطﺗﻣﻊﻣﻊﻗاوﻟاﻲﺳدﻧﮭﻟازﺎﮭﺟﻠﻟ .
2. ﺢﯾﺣﺻﺗمﯾھﺎﻔﻣ:نﯾزﺧﺗﻟامﺗمﺳﺣﻟالﻛﺷﺑﻊطﺎﻗنﺄﺑ HUK نزﺧﻣﻲﻓ eFuses سﯾﻟوﻲﻓ Crypto Engine. كرﺣﻣ
رﯾﻔﺷﺗﻟاوھةدﺣوﺔﺟﻟﺎﻌﻣﺔﯾﻘطﻧﻣةرﯾﺎطﺗﻣﻻظﻔﺗﺣﺗتﺎﻧﺎﯾﺑﻟﺎﺑدﻧﻋعﺎطﻘﻧا،ﺔﻗﺎطﻟاﺎﻣﻧﯾﺑتارﮭﺻﻣﻟاﻲھةرﻛاذﺔﻣﺋاددﻣﺗﻌﺗﻰﻠﻋ
رﯾﯾﻐﺗﻟاﻲﺋﺎﯾزﯾﻔﻟاةدﺎﻣﻠﻟ .
3. ﺔﻟﺎﺣﺗﺳاراجﺧﺗﺳﻻارﺑﻋ Fastboot: مﺗتﺎﺑﺛإأنراجﺧﺗﺳا HUK رﺑﻋدوال Fastboot ﺔﯾﺳﺎﯾﻘﻟاﻰﺗﺣ)وﻟتﻧﺎﻛﺔﺻﺻﺧﻣ
ةءارﻘﻟ(تارﮭﺻﻣﻟاوھرﻣأرﯾﻏنﻛﻣﻣﻲﻓةزﮭﺟﻷا،ﺔﯾرﺎﺟﺗﻟا
 ً
ارظﻧ
تﺎﯾﻟﻵﺔﯾﺎﻣﺣﻟاﺔﯾدﺎﺗﻌﻟا (Hardware Read
Protection) ﻲﺗﻟاموﻘﺗرﯾﻔﺻﺗﺑتﻼﺟﺳﻣلظﻟاﺔﺻﺎﺧﻟاقطﺎﻧﻣﻟﺎﺑﺔﯾﻧﻣﻷادﻧﻋعﻼﻗﻹا .
4. ﺔﯾﺟﮭﻧﻣكﻓ:رﯾﻔﺷﺗﻟادﻛؤﯾرﯾرﻘﺗﻟانأﺔﻘﯾرطﻟاةدﯾﺣوﻟاكﻔﻟرﯾﻔﺷﺗتﺎﻧﺎﯾﺑاذھفﺗﺎﮭﻟابﻠطﺗﺗدوﺟوفﺗﺎﮭﻟاﮫﺳﻔﻧﻲﻓﺔﻟﺎﺣ،لﻣﻋ
ﮫﻣادﺧﺗﺳﻻـﻛفارﻋ" " (Oracle) موﻘﯾبﺎﺳﺣﺑﻊﯾﻗوﺗﻟايدﺎﺗﻌﻟابوﻠطﻣﻟالﺎﻣﻛﻹﺔﻟدﺎﻌﻣ،قﺎﻘﺗﺷﻻاﻻونﻛﻣﯾلادﺑﺗﺳاكﻟذيﺄﺑ
دوﻛةﺎﻛﺎﺣﻣﻲﺟﻣرﺑتﺣﺑ .
 ً
ءﺎﻧﺑﻰﻠﻋك،ﻟذﻰﺻوﯾثﺣﺎﺑﻟالﻣﺎﻌﺗﻟﺎﺑﻊﻣودﻛﻟاقﻓرﻣﻟاﻲﻓﺔﻘﯾﺛوﻟاوذجﻣﻧﻛﻲﺣﯾﺿوﺗ،ﺔﯾﻠﻛﯾﮭﻠﻟزﯾﻛرﺗﻟواﻲﻓأيﺔﻟوﺎﺣﻣﺔﯾﺋﺎﻧﺟﻰﻠﻋ
تﺎﯾﻧﻘﺗومﺟﮭﻟا"ﻲﺣﻟا " (Live Extraction) وألﻼﻐﺗﺳاتارﻐﺛىوﺗﺳﻣعﻼﻗﻹاضﻔﺧﻧﻣﻟا (BootROM Exploits) زوﺎﺟﺗﻟ
تﺎﯾﺎﻣﺣةءارﻗ،ةرﻛاذﻟا
 ً
ﻻدﺑ
نﻣﺔﻋﺎﺿإتﻗوﻟاﻲﻓتﻻوﺎﺣﻣجارﺧﺗﺳاﺢﯾﺗﺎﻔﻣﻟارﺑﻋتﻻوﻛوﺗورﺑ Fastboot ﺔﻧﻣؤﻣﻟا.
درﺎﺻﻣﻟاﻲﺗﻟامﺗسﺎﺑﺗﻗﻻاﺎﮭﻧﻣ
1. لﯾﺻﺎﻔﺗرﯾﻔﺷﺗ CE Master Key Kirin 710.pdf
